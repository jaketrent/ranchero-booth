"use strict";var __moduleName=void 0;console.log("App started");var choose=document.querySelector(".choose"),fileInput=document.querySelector(".file"),canvas=document.querySelector(".canvas"),download=document.querySelector(".download"),ctx=canvas.getContext("2d"),mouseIsDown=!1,stachePos={x:0,y:0},grabOffset={x:0,y:0},stache=document.createElement("img"),avatar=document.createElement("img"),isValidFileType=function(e){return e.type.match(/image.*/)},setupCanvas=function(){addClass(choose,"is-hidden"),removeClass(download,"is-hidden"),stache.src="img/stache-swirl-sm.png",stache.onload=function(){redrawStache()}},readFile=function(e,a){var t=new FileReader;t.onload=function(e){a.src=e.target.result},t.readAsDataURL(e)},isHit=function(e,a){var t=stachePos.x<=e&&e<=stachePos.x+stache.width,s=stachePos.y<=a&&a<=stachePos.y+stache.height;return t&&s},saveGrabOffset=function(e,a){grabOffset={x:e,y:a}},saveStachePos=function(e,a){stachePos={x:e,y:a}},redrawStache=function(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(avatar,0,0,canvas.width,avatar.height*(canvas.height/avatar.width)),ctx.drawImage(stache,stachePos.x,stachePos.y,stache.width,stache.height)},getCoords=function(e,a){var t=e.getBoundingClientRect(),s=a.clientX-t.left,n=a.clientY-t.top;return[s,n]},addClass=function(e,a){e.classList?e.classList.add(a):e.className+=" "+a},removeClass=function(e,a){e.classList?e.classList.remove(a):e.className=e.className.replace(new RegExp("(^|\\b)"+a.split(" ").join("|")+"(\\b|$)","gi")," ")},grabStached=function(e){var a=getCoords(canvas,e),t=a[0],s=a[1];isHit(t,s)&&(saveGrabOffset(t-stachePos.x,s-stachePos.y),mouseIsDown=!0)},moveStache=function(e){if(mouseIsDown){var a=getCoords(canvas,e),t=a[0],s=a[1];saveStachePos(t-grabOffset.x,s-grabOffset.y),redrawStache()}},releaseStache=function(){mouseIsDown=!1},downloadCanvas=function(){download.href=canvas.toDataURL("image/jpeg")},clickFileInput=function(){var e=document.createEvent("HTMLEvents");e.initEvent("click",!0,!1),fileInput.dispatchEvent(e)};document.addEventListener("DOMContentLoaded",function(){fileInput.addEventListener("change",function(e){var a=e.target.files[0];return isValidFileType(a)?(avatar.onload=setupCanvas,void readFile(a,avatar)):void alert("Select an image file")}),canvas.addEventListener("mousedown",grabStached),canvas.addEventListener("mousemove",moveStache),canvas.addEventListener("mouseup",releaseStache),download.addEventListener("click",downloadCanvas),choose.addEventListener("click",clickFileInput)});